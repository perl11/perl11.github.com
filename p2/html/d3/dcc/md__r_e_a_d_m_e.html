<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>p2: ~ readme ~</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">p2
   &#160;<span id="projectnumber">0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d3/dcc/md__r_e_a_d_m_e.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">~ readme ~ </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><pre class="fragment">     .ooo
      'OOOo
  ~ p ooOOOo tion ~
      .OOO
       oO      %% a little
         Oo    fast language.
        'O
         `
        (o)
    ___/ /          
   /`    \ 
  /v^  `  ,
 (...v/v^/
  \../::/
   \/::/ 
</pre><h2>~ potion ~</h2>
<p>Potion is an object- and mixin-oriented (traits) language.</p>
<p>Its exciting points are:</p>
<ul>
<li><p class="startli">Just-in-time compilation to x86 and x86-64 machine code function pointers. This means she's a speedy one. Who integrates very well with C extensions.</p>
<p class="startli">The JIT is turned on by default and is considered the primary mode of operation.</p>
</li>
</ul>
<ul>
<li>Intermediate bytecode format and VM. Load and dump code. Decent speed and cross- architecture. Heavily based on Lua's VM.</li>
</ul>
<ul>
<li>A lightweight generational GC, based on Basile Starynkevitch's work on Qish. <a href="http://starynkevitch.net/Basile/qishintro.html">http://starynkevitch.net/Basile/qishintro.html</a></li>
</ul>
<ul>
<li>Bootstrapped "id" object model, based on Ian Piumarta's soda languages. This means everything in the language, including object allocation and interpreter state are part of the object model. (See COPYING for citations.)</li>
</ul>
<ul>
<li>Interpreter is thread-safe and reentrant. I hope this will facilitate coroutines, parallel interpreters and sandboxing.</li>
</ul>
<ul>
<li>Small. Under 10kloc. Right now we're like 6,000 or something. Install sloccount and run: make sloc.</li>
</ul>
<ul>
<li>Reified AST and bytecode structures. This is very important to me. By giving access to the parser and compiler, it allows people to target other platforms, write code analysis tools and even fully bootstrapped VMs. I'm not as concerned about the Potion VM being fully bootstrapped, especially as it is tied into the JIT so closely.</li>
</ul>
<ul>
<li>Memory-efficient classes. Stored like C structs. (Although the method lookup table can be used like a hash for storing arbitrary data.)</li>
</ul>
<ul>
<li>The JIT is also used to speed up some other bottlenecks. For example, instance variable and method lookup tables are compiled into machine code.</li>
</ul>
<p>However, some warnings:</p>
<ul>
<li>Strings are immutable (like Lua) and byte arrays are used for I/O buffers.</li>
</ul>
<ul>
<li>Limited floating point support yet.</li>
</ul>
<ul>
<li>Limited error handling. I'm wary of just tossing in exceptions and feeling rather uninspired on the matter. Let's hear from you.</li>
</ul>
<h2>~ a whiff of potion ~</h2>
<pre class="fragment">5 times: "Odelay!" print.
</pre><p>Or, </p>
<pre class="fragment">add = (x, y): x + y.
add(2, 4) string print
</pre><p>Or, </p>
<pre class="fragment">hello =
  "(x): ('hello ', x) print." eval
hello ('world')
</pre><h2>~ building and installing ~</h2>
<pre class="fragment">$ make
</pre><p>Look inside the file called INSTALL for options.</p>
<h2>~ how it transpired ~</h2>
<p>This isn't supposed to happen!</p>
<p>I started playing with Lua's internals and reading stuff by Ian Piumarta and Nicolas Cannasse. And I, well... I don't know how this happened!</p>
<p>Turns out making a language is a lovely old time, you should try it. If you keep it small, fit the VM and the parser and the stdlib all into 10k lines, then it's no sweat.</p>
<p>To be fair, I'd been tinkering with the parser for years, though.</p>
<h2>~ the potion pledge ~</h2>
<p>EVERYTHING IS AN OBJECT. However, OBJECTS AREN'T EVERYTHING.</p>
<p>(And, incidentally, everything is a function.)</p>
<h2>~ items to understand ~</h2>
<ol type="1">
<li><p class="startli">A traditional object is a tuple of data and methods: (D, M).</p>
<p class="startli">D is kept in the object itself. M is kept in classes.</p>
</li>
</ol>
<ol type="1">
<li>In Potion, objects are just D.</li>
</ol>
<ol type="1">
<li>Every object has an M.</li>
</ol>
<ol type="1">
<li>But M can be altered, swapped, added to, removed from, whatever.</li>
</ol>
<ol type="1">
<li>Objects do not have classes. The M is a mixin, a collection of methods.</li>
</ol>
<p>Example: all strings have a "length" method. This method comes with Potion. It's in the String mixin.</p>
<ol type="1">
<li>You can swap out mixins for the span of a single source file.</li>
</ol>
<p>Example: you could give all strings a "backwards" method. But just for the code inside your test.pn script.</p>
<ol type="1">
<li>You can re-mix for the span of a single closure.</li>
</ol>
<p>To sum up:</p>
<p>EVERYTHING IS AN OBJECT. EVEN MIXINS ARE OBJECTS. AND, OF COURSE, CLOSURES ARE OBJECTS.</p>
<p>However, OBJECTS AREN'T EVERYTHING. THEY ARE USELESS WITHOUT MIXINS.</p>
<h2>~ unique ideas (to be implemented) ~</h2>
<p>Potion does have a few unique features underway.</p>
<ul>
<li>It is two languages in one.</li>
</ul>
<p>The language itself is objects and closures. </p>
<pre class="fragment">Number add = (x): self + x.
</pre><p>But it also includes a data language. </p>
<pre class="fragment">app = [window (width=200, height=400)
  [button "OK", button "Cancel"]]
</pre><p>The code and data languages can be interleaved over and over again. In a way, I'm trying to find a middle ground between s-expressions and stuff like E4X. I like that s-expressions are a very light data syntax, but I like that E4X clearly looks like data.</p>
<p>When s-expressions appear in Lisp code, they look like code. I think it is nice to distinguish the two.</p>
<ul>
<li>Deeply nested blocks can be closed quickly. I don't like significant whitespace, personally. But I don't like end end end end. <pre class="fragment">say = (phrase):
  10 times (i):
    20 times (j):
      phrase print
_say
</pre></li>
</ul>
<p>The closing "_ say" ends the block saved to "say" var.</p>
<p>Normally, blocks are closed with a period. In this case we'd need three periods, which looks strange. </p>
<pre class="fragment">say = ():
  10 times:
    20 times:
      "Odelay!" print
...
</pre><p>If you prefer, you can give it some space. Or you can use a variable name introduced by the block, </p>
<pre class="fragment">say = (phrase):
  10 times (i):
    20 times (j):
      phrase print
_ phrase

say = (phrase):
  10 times (i):
    20 times (j):
      phrase print
  _ i
.
</pre><p>Maybe it all looks strange. I don't know. I'm just trying things out, okay?</p>
<ul>
<li><p class="startli">Elimination of line noise.</p>
<p class="startli">I avoid @, #, $, %, {}. Stick with ., |, (), [], =, !, ?. Easier on the eyes. These are common punctuations in English.</p>
</li>
</ul>
<ul>
<li>I try to defer to English when it comes to punctuation rules.</li>
</ul>
<p>Period means "end". (In other langs it means "method call".) Comma breaks up statements. Space between messages gives a noun-verb feeling. </p>
<pre class="fragment">window open (width=400, height=500)
</pre><ul>
<li><p class="startli">Named block args</p>
<p class="startli">(1, 2, 3) map (item=x, index=i): i display, x + 1.</p>
</li>
</ul>
<h2>~ feverish and fond thankyous ~</h2>
<p>I am gravely indebted to Basile Starynkevitch, who fielded my questions about his garbage collector. I favor French hackers to an extreme (Xavier Leroy, Nicolas Cannasse, Guy Decoux, Mathieu Bochard to name only a portion of those I admire) and am very glad to represent their influence in Potion's garbage collector.</p>
<p>Matz, for answering my questions about conservative GC and for encouraging me so much. Potion's stack scanning code and some of the object model come from Ruby.</p>
<p>Steve Dekorte for the Io language, libgarbagecollector and libcoroutine &ndash; I referred frequently to all of them in sorting out what I wanted.</p>
<p>Of course, Mauricio Fernandez for his inspiring programming journal housed at <a href="http://eigenclass.org/R2/">http://eigenclass.org/R2/</a> and for works derived throughout the course of it &ndash; extprot most of all. Many of my thoughts about language internals (object repr, GC, etc.) are informed by him.</p>
<p>Ian Piumarta for peg/leg. I use a re-entrant custom version of it, but the original library is sheer minimalist parsing amazement.</p>
<p>Final appreciations to Jonathan Wright and William Morgan who pitched in, back in the wee hours of Potion's history. Tanks.</p>
<h2>~ license ~</h2>
<p>See COPYING for legal information. It's an MIT license, which lets you do anything you want with this. I'm hoping that makes it very nice for folks who want to embed a little Potion in their app!</p>
<p>~ p2 ~ </p>
<pre class="fragment">   .ooo
    'OOOo
~ p ooOOOo 2 ~
    .OOO
     oO      %% a fast perl5
       Oo
      'O
       `
      (o)
  ___/ /          
 /`    \ 
/v^  `  ,
</pre><p> (...v/v^/ ../::/ \/::/</p>
<p>p2 is a she. She is a perl5 and possible perl6/nqp backend, based on why the luck stiff's potion. See README why potion is exciting. Homepage: <a href="http://perl11.org/p2/">http://perl11.org/p2/</a></p>
<p>parrot examples/benchmarks/fib.pir 28 1.746s perl examples/benchmarks/fib.pl 28 0.439s potion examples/benchmarks/fib.pn 28 0.013s</p>
<p>parrot examples/benchmarks/fib.pir 40 3m36.447s perl examples/benchmarks/fib.pl 40 2m19.752s potion examples/benchmarks/fib.pn 40 0m3.512s</p>
<p>Its exciting points for perl folks are:</p>
<ul>
<li>Should parse most of perl5, just some XS and B tricks not. Since the original perl5 testsuite is not usable for other implementations and compilers it needs to be adjusted. The perl6 testsuite is in a better shape.</li>
</ul>
<ul>
<li>signatures, types, native threads for perl5. Hopefully macros also.</li>
</ul>
<ul>
<li>Using most of Damian Conway's p5i recommendations: i.e. classes are immutable and final by default. See <a href="http://web.archive.org/web/20040207072905/http://www.yetanother.org/damian/Perl5+i/">http://web.archive.org/web/20040207072905/http://www.yetanother.org/damian/Perl5+i/</a></li>
</ul>
<ul>
<li>libp2 is usable as a fast backend for nqp/perl6, parsing p6 natively should also be possible.</li>
</ul>
<ul>
<li>Native and fast calling convention, no XS stack args on the heap. XS is replaced by dlcall (dynamic ffi), and/or shared libraries with normal function calls into the vm.</li>
</ul>
<ul>
<li>int, str, num are objects, you can optionally type all args and lexical variables. In fact everything is an object as in parrot, even the compiler, the parser, the vm.</li>
</ul>
<ul>
<li><p class="startli">Sized arrays are non-autovivifying and initialized with undef, resp. if typed 0, 0.0, "".</p>
<p class="startli">my $a[3]; print $a[3] =&gt; compile-time error: array out of bounds my int $i[3]; print $a[2] =&gt; 0 my num $n[3]; print $n[2] =&gt; 0.0 my str $s[3]; print $a[2] =&gt; ""</p>
</li>
</ul>
<ul>
<li><p class="startli">A new pragma "no magic" applies to all visible objects in scope. { no magic; use Config; print $Config{'ccflags'}; } =&gt; compile-time error: Invalid use of tie with no magic</p>
<p class="startli">use { no magic; use Config (); print $Config::Config{'ccflags'}; } instead.</p>
</li>
</ul>
<ul>
<li>p6model: via scoped mixins, :multi, roles. Like Moose, just better and much faster. (roughly estimated 800x faster)</li>
</ul>
<ul>
<li>smartmatch works because all data are typed objects. A destructuring-bind alike new match operator which matches structures (list, trees, hashes of hashes) against structures.</li>
</ul>
<ul>
<li>Just-in-time compilation for x86, x86-64 and ppc done. arm later.</li>
</ul>
<ul>
<li>Intermediate bytecode format and VM. Load and dump code. Decent speed and cross-architecture. Heavily based on Lua's VM.</li>
</ul>
<ul>
<li>A lightweight generational GC, based on Basile Starynkevitch's work on Qish. <a href="http://starynkevitch.net/Basile/qishintro.html">http://starynkevitch.net/Basile/qishintro.html</a> The compiler will add hooks for objects leaving scope and add DESTROY method calls if they are visible at compile-time. Run-time created DESTROY methods will not be automatically called.</li>
</ul>
<ul>
<li>Bootstrapped "id" object model, based on Ian Piumarta's soda languages. This means everything in the language, including object allocation, parser, compiler and interpreter state are part of the object model. (See COPYING for citations.) In fact are all objects and classes closures, which simplifies scoping, and makes p2 a functional vm.</li>
</ul>
<ul>
<li>Planned is an extensibe parser to implement macros and scoped syntax blocks (for ffi, p6, and other languages).</li>
</ul>
<ul>
<li>Interpreter is thread-safe and reentrant. I hope this will facilitate coroutines, parallel interpreters and sandboxing.</li>
</ul>
<ul>
<li>Small. Under 10kloc. Right now we're like 6,000 or something. Install sloccount and run: make sloc.</li>
</ul>
<ul>
<li>Reified AST and bytecode structures. This is very important to me. By giving access to the parser and compiler, it allows people to target other platforms, write compilers, debuggers, code analysis tools and even fully bootstrapped VMs. I'm not as concerned about the Potion VM being fully bootstrapped, especially as it is tied into the JIT so closely.</li>
</ul>
<ul>
<li>Memory-efficient classes. Stored like C structs. (Although the method lookup table can be used like a hash for storing arbitrary data.)</li>
</ul>
<ul>
<li>The JIT is also used to speed up some other bottlenecks. For example, instance variable and method lookup tables are compiled into machine code.</li>
</ul>
<p>However, some warnings:</p>
<ul>
<li>Strings are immutable (like Lua) and byte arrays are used for I/O buffers. All strings and symbols are utf8 internally.</li>
</ul>
<ul>
<li>Limited floating point support, no bigums yet. ints cannot hold pointers and need to be boxed. This should be transparent though.</li>
</ul>
<ul>
<li>Limited error handling.</li>
</ul>
<ul>
<li>No signal handling, ffi, thread-safe GC, asynchronuous IO yet.</li>
</ul>
<p>~ thankyous ~</p>
<p>why the lucky stiff left the ruby community. potion was his last public project. It's a work of art and mastership. I could not think of anything better. I think it is better than Go, if potion would have had added auto-threads and channels.</p>
<p>Rob Pike for Go, and the parrot community for parrot.</p>
<p>Larry Wall for perl5. We miss his leadership and technical excellence. Without him nothing got done, and if something was done it was wrong. Besides defined-or, which left Tom Christiansen behind.</p>
<p>why the lucky stiff thanks: I am gravely indebted to Basile Starynkevitch, who fielded my questions about his garbage collector. I favor French hackers to an extreme (Xavier Leroy, Nicolas Cannasse, Guy Decoux, Mathieu Bochard to name only a portion of those I admire) and am very glad to represent their influence in Potion's garbage collector.</p>
<p>Matz, for answering my questions about conservative GC and for encouraging me so much. Potion's stack scanning code and some of the object model come from Ruby.</p>
<p>Steve Dekorte for the Io language, libgarbagecollector and libcoroutine &ndash; I referred frequently to all of them in sorting out what I wanted.</p>
<p>Of course, Mauricio Fernandez for his inspiring programming journal housed at <a href="http://eigenclass.org/R2/">http://eigenclass.org/R2/</a> and for works derived throughout the course of it &ndash; extprot most of all. Many of my thoughts about language internals (object repr, GC, etc.) are informed by him.</p>
<p>Ian Piumarta for peg/leg. I use a re-entrant custom version of it, but the original library is sheer minimalist parsing amazement.</p>
<p>Final appreciations to Jonathan Wright and William Morgan who pitched in, back in the wee hours of Potion's history. Tanks.</p>
<p>~ license ~</p>
<p>See COPYING for legal information. potion is an MIT license, which lets you do anything you want with this. perl5 code is ARTISTIC and GPL dual licensed, p2 and perl6 code is ARTISTIC 2 licensed. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Apr 24 21:08:23 CDT 2013 for p2 0.0 (date='2013-04-24',
) by <a href="http://www.doxygen.org/index.html">doxygen</a> 1.8.1.2 
</small></address></body></html>
