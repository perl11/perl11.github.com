<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>p2: ~ readme ~</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">p2
   &#160;<span id="projectnumber">0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d3/dcc/md__r_e_a_d_m_e.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">~ readme ~ </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>.ooo 'OOOo ~ p ooOOOo tion ~ .OOO oO %% a little Oo fast language. 'O ` (o) ___/ / /<code>\ /v^</code> , (...v/v^/ ../::/ \/::/</p>
<p>p2 is a she. She is a perl5 and possible perl6/nqp backend, based on why the luck stiff's potion. See <code>README.potion</code> why potion is exciting. Homepage: <a href="http://perl11.org/p2/">http://perl11.org/p2/</a></p>
<p>parrot example/fib.pir 28 0m1.746s perl example/fib.pl 28 0m0.439s p2 -B example/fib.p2 28 0m0.177s potion example/fib.pn 28 0m0.013s p2 example/fib.p2 28 0m0.013s</p>
<p>parrot example/fib.pir 40 3m36.447s perl example/fib.pl 40 2m19.752s p2 -B example/fib.p2 40 0m54.560s potion example/fib.pn 40 0m3.512s p2 example/fib.p2 40 0m3.512s</p>
<p>For most small examples comparable performance to lua and C. For bigger examples optimizable via static types/early binding.</p>
<p>Its exciting points for perl folks are:</p>
<ul>
<li>Radically simplified and functional core.</li>
<li>Should parse most of perl5, just some XS and B tricks not.</li>
<li>Signatures, fast mop, types, native threads, call-replacing macros for perl5.</li>
<li>No worries about pseudo-scientific discussions, project management, performance bugs and feature deadlocks. Leaving the slack behind.</li>
<li>A lightweight generational GC, based on Basile Starynkevitch's work on Qish, with ~4ms per GC on average with &lt; 100MB heaps. <a href="http://starynkevitch.net/Basile/qishintro.html">http://starynkevitch.net/Basile/qishintro.html</a> The compiler will add hooks for objects leaving scope and add DESTROY method calls if they are visible at compile-time. Run-time created DESTROY methods will not be automatically called.</li>
<li>Using most of Damian Conway's p5i recommendations: i.e. classes are immutable and final by default. See <a href="http://web.archive.org/web/20040207072905/http://www.yetanother.org/damian/Perl5+i/">http://web.archive.org/web/20040207072905/http://www.yetanother.org/damian/Perl5+i/</a></li>
<li>libp2 is usable as a fast backend for nqp/perl6, but parsing and supporting p6 natively without going through nqp and the rakudo bootstrapping process should be easier and faster. Tokuhiro Matsuno already wrote a p6 parser, pvip.</li>
<li>Native and fast calling convention, no XS stack args on the heap. XS is replaced by extern (dynamic ffi), and/or shared libraries with normal function calls into the vm.</li>
<li>Just-in-time compilation for x86, x86-64 and ppc done. arm later.</li>
<li>Intermediate bytecode format and VM. Load and dump code. Decent speed and cross-architecture. Heavily based on Lua's VM.</li>
<li>int, str, num are objects, you can optionally type all args and lexical variables. In fact everything is an object as in parrot, even the parsed AST, the vm state.</li>
<li><p class="startli">Sized arrays are non-autovivifying and initialized with undef, resp. if typed 0, 0.0, "".</p>
<p class="startli">my $a[3]; print $a[3] =&gt; compile-time error: array out of bounds my int $i[3]; print $a[2] =&gt; 0 my num $n[3]; print $n[2] =&gt; 0.0 my str $s[3]; print $a[2] =&gt; ""</p>
</li>
<li><p class="startli">A new pragma "no magic" applies to all visible objects in scope. { no magic; use Config; print $Config{'ccflags'}; } =&gt; compile-time error: Invalid use of tie with no magic</p>
<p class="startli">use { no magic; use Config (); print $Config::Config{'ccflags'}; } instead.</p>
</li>
<li>p6model: via scoped mixins, :multi, roles. Like Moose, just better and roughly estimated 800x faster. No multiple inheritance yet, @ISA == 1. Only one parent, depending on another parent, rather multiple mixin compositions.</li>
<li>~~ match works because all data are typed objects. A destructuring-bind alike new match operator which matches structures (list, trees, hashes of hashes) against structures, values and types.</li>
<li>Bootstrapped "id" object model, based on Ian Piumarta's soda languages. This means everything in the language, including object allocation, parser, compiler and interpreter state are part of the object model. (See COPYING for citations.) In fact all objects and classes are closures, which simplifies scoping, and makes p2/potion a functional vm.</li>
<li>parsers are scoped and run-time loadable for ffi, p6, and other languages.</li>
<li>Interpreter is thread-safe and reentrant. This should facilitate parallel interpreters initialized in a threadpool.</li>
<li>Small core. Under 10kloc. Install sloccount and run: <code>make sloc</code>.</li>
<li>Reified AST and bytecode structures. This is very important to me. By giving access to the parser and compiler, it allows people to target other platforms, write compilers, debuggers, code analysis tools and even fully bootstrapped VMs. I'm not as concerned about the Potion VM being fully bootstrapped, especially as it is tied into the JIT so closely.</li>
<li>Memory-efficient classes. Stored like C structs. (Although the method lookup table can be used like a hash for storing arbitrary data.)</li>
<li>The JIT is also used to speed up some other bottlenecks. For example, instance variable and method lookup tables are compiled into machine code.</li>
<li>Fast asynchronous IO via libuv</li>
</ul>
<p>However, some warnings:</p>
<ul>
<li>Ints cannot hold pointers and need to be boxed. This should be transparent though. Use WeakRefs for pointers.</li>
<li>Strings are immutable (like Lua) and byte arrays are used for I/O buffers. All strings and symbols are utf8 internally.</li>
<li>Limited platform support for coroutines. This affects exceptions.</li>
<li>No regular expression bindings yet (pcre or sregex)</li>
<li>The parser is not GC safe yet. This affects eval. Do not waste too much memory inside eval.</li>
<li>No OS threads yet.</li>
<li>No signal handling yet.</li>
<li>The compiler is mostly good enough, as in lua, but there are no tradional compiler optimizations yet. We'd might need to add constant folding and propagation, simple local basic block optimizations, peephole optimizations, loop optimizations, tracking side-effects. And tailcalls are not yet detected.</li>
<li>No type checks, bounds-check elimination and type optimizations yet.</li>
</ul>
<h2>~ building and installing ~</h2>
<pre class="fragment">$ make
$ make install
</pre><p>Look inside the file called <code><a class="el" href="../../d1/d58/_i_n_s_t_a_l_l_8md.html">INSTALL.md</a></code> for options.</p>
<h2>~ feverish and fond thankyous ~</h2>
<p>why the lucky stiff left the ruby community. potion was his last public project. It's a work of great art and mastership. I could not think of anything better. I think it is better than Go, if potion would have had added auto-threads and channels.</p>
<p>Rob Pike for Go, and the parrot community for parrot.</p>
<p>Larry Wall for perl5. We miss his leadership and technical excellence. Without him nothing got done, and if something was done it was wrong. Besides defined-or, which left Tom Christiansen behind.</p>
<p>why the lucky stiff thanks:</p>
<p>why is gravely indebted to Basile Starynkevitch, who fielded questions about his garbage collector. why favors French hackers to an extreme (Xavier Leroy, Nicolas Cannasse, Guy Decoux, Mathieu Bochard to name only a portion of those he admires) and is very glad to represent their influence in Potion's garbage collector.</p>
<p>Matz, for answering why's questions about conservative GC and for encouraging him so much. Potion's stack scanning code and some of the object model come from Ruby.</p>
<p>Steve Dekorte for the Io language, libgarbagecollector and libcoroutine &ndash; He referred frequently to all of them in sorting out what he wanted.</p>
<p>Of course, Mauricio Fernandez for his inspiring programming journal housed at <a href="http://eigenclass.org/R2/">http://eigenclass.org/R2/</a> and for works derived throughout the course of it &ndash; extprot most of all. Many of my thoughts about language internals (object repr, GC, etc.) are informed by him.</p>
<p>Ian Piumarta for peg/leg. We use a re-entrant customized version of it, but the original library is sheer minimalist parsing amazement.</p>
<p>Final appreciations to Jonathan Wright and William Morgan who pitched in, back in the wee hours of Potion's history. Thanks.</p>
<h2>~ license ~</h2>
<p>See COPYING for legal information. potion is MIT licensed, which lets you do anything you want with this. p2 and perl6 code is ARTISTIC 2 licensed. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Mar 04 2015 for p2 "0.0" (date="2014-10-09")
by <a href="http://www.doxygen.org/index.html">doxygen</a>  1.8.7
</small></address></body></html>
