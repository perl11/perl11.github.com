<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>p2: ~ building potion ~</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">p2
   &#160;<span id="projectnumber">0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d8/de3/md__i_n_s_t_a_l_l.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">~ building potion ~ </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Normally </p><pre class="fragment">$ make
</pre><p>To build with debugging symbols </p><pre class="fragment">$ make DEBUG=1
</pre><p>To build without JIT </p><pre class="fragment">$ make JIT=0
</pre><p>Lastly, to verify your build </p><pre class="fragment">$ make test
</pre><p>On a typical GNU make &lt; 4.0 sometimes the <code>test/classes/creatures/</code> fails. Try <code>make -j1 test</code> or gmake-4.0 then.</p>
<h2>~ the latest potion ~</h2>
<p>To build the bleeding edge, you will need GNU make, binutils, perl, sed, git and gcc or better clang. clang produces better code than gcc, but is harder to debug. gcc-4.6.3 is broken, at least on ubuntu. </p><pre class="fragment">$ git clone git://github.com/perl11/potion.git
$ cd potion
$ git submodule update --init
$ make
</pre><h2>~ external dependencies ~</h2>
<pre class="fragment">build-time: gnu make, perl, sed, gcc or clang, echo, cat, expr, git
perl is only needed because of BSD/darwin sed problems

run-time:
libuv (later: pcre, libtomath) is included, but external
packagers should choose to use existing packages. see `dist.mak`

optional:

libudis on x86 (debugging only)
  http://udis86.sourceforge.net/ x86 16,32,64 bit
  port install udis86

libdistorm64 on x86 (debugging only)
  http://ragestorm.net/distorm/ x86 16,32,64 bit with all intel/amd extensions
  apt-get install libdistorm64-dev

libdisasm on i386 (debugging only)
  http://bastard.sourceforge.net/libdisasm.html 386 32bit only
  apt-get install libdisasm-dev

sloccount (for make sloc)
  apt-get install sloccount

redcloth (for make doc install)
  apt-get install ruby-redcloth, or
  port install rb-redcloth

doxygen 1.8 or 1.9 (for make doc install)
  apt-get install doxygen, or
  port install doxygen

GNU global (for make docall install)
  apt-get install global, or
  port install global
</pre><h2>~ sandboxing ~</h2>
<p>With <code>gmake SANDBOX=1</code> a static sandboxed <code>bin/potion-s</code> is built, which excludes all local filesystem and process accesses and includes all external modules in one executable. <code>load</code> is also disabled, so modules must include all dependent libraries.</p>
<p>Network access is enabled via <a class="el" href="../../da/d46/class_aio.html">Aio</a>. If you want to disable networking also, remove <code>lib/aio.c</code> from the SANDBOX SRC in <code>Makefile</code>, and <code>Potion_Init_aio(P)</code> from <code>core/internal.c</code></p>
<h2>~ installing ~</h2>
<pre class="fragment">$ sudo make install
</pre><h2>~ building on windows ~</h2>
<p>Potion's win32 binaries are built using MinGW. <a href="http://mingw.org/">http://mingw.org/</a></p>
<p>It's a bit hard to setup mingw and gmake on Windows. I usually run a shell under Cygwin and add MinGW to my <code>$PATH</code>.</p>
<p>Once that's all done, </p><pre class="fragment">$ make
</pre><p>The easiest way to do this, actually, is on Linux or Darwin. On Ubuntu, if you have MinGW installed, </p><pre class="fragment">$ make clean; make core/syntax.c
$ make config CC=i686-w64-mingw32-gcc CROSS=1
$ touch core/syntax.c
$ make &amp;&amp; make dist
</pre><p>This will first create a native greg and <code>core/syntax.c</code>, sets <code>CROSS=1</code> and cross-compile with the given CC. See <code>tools/mk-release.sh</code></p>
<p><code>make test</code> will not work, you need to copy a make dist tarball to the machine and test it there.</p>
<p>win64 is not supported yet. It uses a slighlty different ABI, cygwin64 misses pthread_barrier_t. and x86_64-w64-mingw32-gcc fails by creating a wrong <code><a class="el" href="../../db/d16/config_8h.html">config.h</a></code></p>
<h2>~ building on bsd ~</h2>
<p>BSD make is not supported. You can either install gnu make (gmake) </p><pre class="fragment">$ sudo port install gmake
</pre><p>or try <code>./configure</code> which creates a special BSD <code>config.mk</code></p>
<p>or try to merge <code>master</code> with the branch <code>bsd</code> </p><pre class="fragment">$ git merge bsd
... resolve conflicts, or not
</pre><h2>~ building with a strict C++ compiler ~</h2>
<p>potion does not support strict C++ compilers. If you have no modern C compiler:</p>
<p>Either add a C dialect to CC in config.inc (i.e. <code>-std=c89</code>), </p><pre class="fragment">g++ --help=C; clang++ -x C -std=gnu89
</pre><p>or try to merge with the branch <code>p2-c++</code>.</p>
<h2>~ creating documentation ~</h2>
<p>This is required for <code>make dist</code> and release admins. You'll need: </p><pre class="fragment">redcloth to convert .textile to html,
doxygen (1.8 or 1.9), and
GNU global for gtags and htags
</pre><p>On windows et al.: <code>gem install RedCloth</code> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Feb 02 2018 for p2 "0.0" (date="2016-11-20")
by <a href="http://www.doxygen.org/index.html">doxygen</a>  1.8.13
</small></address></body></html>
