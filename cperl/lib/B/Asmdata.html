<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>B::Asmdata - Autogenerated data about Perl ops, used to generate bytecode</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:rurban@cpan.org" />
</head>

<body>



<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a></li>
  <li><a href="#PORTABILITY">PORTABILITY</a>
    <ul>
      <li><a href="#CROSS-PLATFORM-PORTABILITY">CROSS-PLATFORM PORTABILITY</a></li>
      <li><a href="#CROSS-VERSION-PORTABILITY-TODO---HARD">CROSS-VERSION PORTABILITY (TODO - HARD)</a></li>
    </ul>
  </li>
  <li><a href="#AUTHOR">AUTHOR</a></li>
</ul>

<h1 id="NAME">NAME</h1>

<p>B::Asmdata - Autogenerated data about Perl ops, used to generate bytecode</p>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<pre><code>        use B::Asmdata qw(%insn_data @insn_name @optype @specialsv_name);</code></pre>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>Provides information about Perl ops in order to generate bytecode via a bunch of exported variables. Its mostly used by B::Assembler and B::Disassembler.</p>

<dl>

<dt id="insn_data">%insn_data</dt>
<dd>

<pre><code>  my($bytecode_num, $put_sub, $get_meth) = @$insn_data{$op_name};</code></pre>

<p>For a given $op_name (for example, &#39;cop_label&#39;, &#39;sv_flags&#39;, etc...) you get an array ref containing the bytecode number of the op, a reference to the subroutine used to &#39;PUT&#39; the op argument to the bytecode stream, and the name of the method used to &#39;GET&#39; op argument from the bytecode stream.</p>

<p>Most ops require one arg, in fact all ops without the PUT/GET_none methods, and the GET and PUT methods are used to en-/decode the arg to binary bytecode. The names are constructed from the GET/PUT prefix and the argument type, such as U8, U16, U32, svindex, opindex, pvindex, ...</p>

<p>The PUT method is used in the <a href="/cperl/lib/B/Bytecode.html">B::Bytecode</a> compiler within <a href="/cperl/lib/B/Assembler.html">B::Assembler</a>, the GET method just for the <a href="/cperl/lib/B/Disassembler.html">B::Disassembler</a>. The GET method is not used by the binary <a href="/cperl/lib/ByteLoader.html">ByteLoader</a> module.</p>

<p>A full <code>insn</code> table with version, opcode, name, lvalue, argtype and flags is located as DATA in <i>bytecode.pl</i>.</p>

<p>An empty PUT method, the number 0, denotes an unsupported bytecode for this perl. It is there to support disassembling older perl bytecode. This was added with 1.02_02.</p>

</dd>
<dt id="insn_name">@insn_name</dt>
<dd>

<pre><code>  my $op_name = $insn_name[$bytecode_num];</code></pre>

<p>A simple mapping of the bytecode number to the name of the op. Suitable for using with %insn_data like so:</p>

<pre><code>  my $op_info = $insn_data{$insn_name[$bytecode_num]};</code></pre>

</dd>
<dt id="optype">@optype</dt>
<dd>

<pre><code>  my $op_type = $optype[$op_type_num];</code></pre>

<p>A simple mapping of the op type number to its type (like &#39;COP&#39; or &#39;BINOP&#39;).</p>

<p>Since Perl version 5.10 defined in <a href="/cperl/lib/B.html">B</a>.</p>

</dd>
<dt id="specialsv_name">@specialsv_name</dt>
<dd>

<pre><code>  my $sv_name = $specialsv_name[$sv_index];</code></pre>

<p>Certain SV types are considered &#39;special&#39;. They&#39;re represented by B::SPECIAL and are referred to by a number from the specialsv_list. This array maps that number back to the name of the SV (like &#39;Nullsv&#39; or &#39;&amp;PL_sv_undef&#39;).</p>

<p>Since Perl version 5.10 defined in <a href="/cperl/lib/B.html">B</a>.</p>

</dd>
</dl>

<h1 id="PORTABILITY">PORTABILITY</h1>

<p>All bytecode values are already portable. Cross-platform portability is implemented, cross-version not yet.</p>

<p>Cross-version portability will be very limited, cross-platform only for the same threading model.</p>

<h2 id="CROSS-PLATFORM-PORTABILITY">CROSS-PLATFORM PORTABILITY</h2>

<p>For different endian-ness there are ByteLoader converters in effect. Header entry: byteorder.</p>

<p>64int - 64all - 32int is portable. Header entry: ivsize</p>

<p>ITHREADS are unportable; header entry: archflag - bitflag 1. MULTIPLICITY is also unportable; header entry: archflag - bitflag 2</p>

<p>TODO For cross-version portability we will try to translate older bytecode ops to the current perl op via <a>ByteLoader::Translate</a>. Asmdata already contains the old ops, all with the PUT method 0. Header entry: perlversion</p>

<h2 id="CROSS-VERSION-PORTABILITY-TODO---HARD">CROSS-VERSION PORTABILITY (TODO - HARD)</h2>

<p>Bytecode ops: We can only reliably load bytecode from previous versions and promise that from 5.10.0 on future versions will only add new op numbers at the end, but will never replace old opcodes with incompatible arguments. Unsupported insn&#39;s are supported by disassemble, and if <code>force</code> in the ByteLoader is set, it is tried to load/set them also, with probably fatal consequences. On the first unknown bytecode op from a future version - added to the end - we will die.</p>

<p><a>ByteLoader::BcVersions</a> contains logic to translate previous errors from this bytecode policy. E.g. 5.8 violated the 5.6 bytecode order policy and began to juggle it around (similar to parrot), in detail removed various bytecodes, like ldspecsvx:7, xpv_cur, xpv_len, xiv64:26. So in theory it would have been possible to load 5.6 into 5.8 bytecode as the underlying perl pp_code ops didn&#39;t change that much, but it is risky.</p>

<p>We have unused tables of all bytecode ops for all version-specific changes to the bytecode table. This only changed with the ByteLoader version, ithreads and major Perl versions.</p>

<p>Also special replacements in the byteloader for all the unsupported ops, like xiv64, cop_arybase.</p>

<h1 id="AUTHOR">AUTHOR</h1>

<p>Malcolm Beattie <code>MICB at cpan.org</code> <i>(retired)</i>, Reini Urban added the version logic, support &gt;= 5.10, portability.</p>


</body>

</html>


