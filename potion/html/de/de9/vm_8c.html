<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>potion: vm.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">potion
   &#160;<span id="projectnumber">0.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('de/de9/vm_8c.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">vm.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>the vm execution loop, the "bytecode interpreter".  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdarg.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;math.h&gt;</code><br />
<code>#include &quot;<a class="el" href="../../dd/d07/potion_8h_source.html">potion.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../db/dde/internal_8h_source.html">internal.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d3/de6/opcodes_8h_source.html">opcodes.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../de/d21/asm_8h_source.html">asm.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d2/deb/khash_8h_source.html">khash.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../dd/d98/table_8h_source.html">table.h</a>&quot;</code><br />
<code>#include &lt;dlfcn.h&gt;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Include dependency graph for vm.c:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d8/d9e/vm_8c__incl.png" border="0" usemap="#vm_8c" alt=""/></div>
<map name="vm_8c" id="vm_8c">
<area shape="rect" id="node6" href="../../dd/d07/potion_8h.html" title="The potion API. " alt="" coords="333,155,403,181"/>
<area shape="rect" id="node12" href="../../db/dde/internal_8h.html" title="non&#45;API internal parts " alt="" coords="427,155,504,181"/>
<area shape="rect" id="node13" href="../../d3/de6/opcodes_8h.html" title="the Potion VM instruction set (heavily based on Lua&#39;s) " alt="" coords="565,80,649,107"/>
<area shape="rect" id="node14" href="../../de/d21/asm_8h.html" title="some assembler macros " alt="" coords="673,80,732,107"/>
<area shape="rect" id="node15" href="../../d2/deb/khash_8h.html" title="klib hash table library based on double hashing http://en.wikipedia.org/wiki/Double_hashing ..." alt="" coords="237,155,307,181"/>
<area shape="rect" id="node17" href="../../dd/d98/table_8h.html" title="the central table type, based on core/khash.h " alt="" coords="339,80,402,107"/>
<area shape="rect" id="node11" href="../../db/d16/config_8h.html" title="config.h" alt="" coords="515,229,584,256"/>
</map>
</div>
</div>
<p><a href="../../de/de9/vm_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a1190440d6cfda0c07c3aceed5c69cdfa"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#a1190440d6cfda0c07c3aceed5c69cdfa">DEBUG_IN_C</a></td></tr>
<tr class="separator:a1190440d6cfda0c07c3aceed5c69cdfa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27b296fccb4da1e9cfcf1f9c810e619e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#a27b296fccb4da1e9cfcf1f9c810e619e">STACK_MAX</a>&#160;&#160;&#160;4096</td></tr>
<tr class="separator:a27b296fccb4da1e9cfcf1f9c810e619e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0d60f35e73dff59f1522b9403410b41"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#ac0d60f35e73dff59f1522b9403410b41">JUMPS_MAX</a>&#160;&#160;&#160;1024</td></tr>
<tr class="separator:ac0d60f35e73dff59f1522b9403410b41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65a37a7116a55e32f389eb26a744d647"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#a65a37a7116a55e32f389eb26a744d647">CASE_OP</a>(<a class="el" href="../../d2/d47/compile_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>,  <a class="el" href="../../d2/d47/compile_8c.html#a696b922b70259bfcac0d3acf49cdf178">args</a>)&#160;&#160;&#160;case OP_##name: target-&gt;op[OP_##<a class="el" href="../../d2/d47/compile_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>]<a class="el" href="../../d2/d47/compile_8c.html#a696b922b70259bfcac0d3acf49cdf178">args</a>; break;</td></tr>
<tr class="separator:a65a37a7116a55e32f389eb26a744d647"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a52b5b4d420539ca92456c045c481368b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#a52b5b4d420539ca92456c045c481368b">PN_VM_MATH2</a>(<a class="el" href="../../d2/d47/compile_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>,  oper)</td></tr>
<tr class="separator:a52b5b4d420539ca92456c045c481368b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23768bb10de9c4d20cb1b74b8a951a3e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#a23768bb10de9c4d20cb1b74b8a951a3e">PN_VM_MATH3</a>(<a class="el" href="../../d2/d47/compile_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>,  oper,  ov)&#160;&#160;&#160;<a class="el" href="../../de/de9/vm_8c.html#a52b5b4d420539ca92456c045c481368b">PN_VM_MATH2</a>(<a class="el" href="../../d2/d47/compile_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, oper)</td></tr>
<tr class="separator:a23768bb10de9c4d20cb1b74b8a951a3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6272743ca8f74f9bf773bc00a29b6d6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#ab6272743ca8f74f9bf773bc00a29b6d6">PN_VM_NUMCMP</a>(cmp)</td></tr>
<tr class="separator:ab6272743ca8f74f9bf773bc00a29b6d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1475d3cd0164f9acb0f3755c4295befa"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#a1475d3cd0164f9acb0f3755c4295befa">PN_VM_CMP</a>(cmp)</td></tr>
<tr class="separator:a1475d3cd0164f9acb0f3755c4295befa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6343b48e6930795fb31fac1833c7749a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#a6343b48e6930795fb31fac1833c7749a">L</a>(op)&#160;&#160;&#160;L_##op</td></tr>
<tr class="separator:a6343b48e6930795fb31fac1833c7749a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afcab46b56d9082d983c0b03989e590ee"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#afcab46b56d9082d983c0b03989e590ee">SWITCH_START</a>(op)&#160;&#160;&#160;goto *jmptbl[op.code];</td></tr>
<tr class="separator:afcab46b56d9082d983c0b03989e590ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a153f27ef7492a37273c263427099ceb6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#a153f27ef7492a37273c263427099ceb6">CASE</a>(op,  block)&#160;&#160;&#160;<a class="el" href="../../de/de9/vm_8c.html#a6343b48e6930795fb31fac1833c7749a">L</a>(op): { block; } goto L_end;</td></tr>
<tr class="separator:a153f27ef7492a37273c263427099ceb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a886e28203c262455d99122704a9f0be9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#a886e28203c262455d99122704a9f0be9">SWITCH_END</a>&#160;&#160;&#160;L_end: ;</td></tr>
<tr class="separator:a886e28203c262455d99122704a9f0be9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a99fb83031ce9923c84392b4e92f956b5"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <br />
&#160;&#160;<a class="el" href="../../de/de9/vm_8c.html#a99fb83031ce9923c84392b4e92f956b5a976f4de2b5b0dcf52111e7518a3b253d">DBG_STEP</a> = 0, 
<a class="el" href="../../de/de9/vm_8c.html#a99fb83031ce9923c84392b4e92f956b5a269f85d8d6e1c649eaec51db48af8722">DBG_NEXT</a>, 
<a class="el" href="../../de/de9/vm_8c.html#a99fb83031ce9923c84392b4e92f956b5aaf2b97d2e3071fa366bed80b171098fe">DBG_RUN</a>, 
<a class="el" href="../../de/de9/vm_8c.html#a99fb83031ce9923c84392b4e92f956b5a75cf8929d9fa302de05912ff7e3a8877">DBG_QUIT</a>, 
<br />
&#160;&#160;<a class="el" href="../../de/de9/vm_8c.html#a99fb83031ce9923c84392b4e92f956b5a6aed3f78de1f8030bc5fd5281384057a">DBG_EXIT</a>
<br />
 }</td></tr>
<tr class="separator:a99fb83031ce9923c84392b4e92f956b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a43f53d1bb0ff2cba095a076fcb9c1ef2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#a43f53d1bb0ff2cba095a076fcb9c1ef2">potion_vm_init</a> (<a class="el" href="../../dd/d07/potion_8h.html#a8218d006431d872b014396d48f881023">Potion</a> *P)</td></tr>
<tr class="separator:a43f53d1bb0ff2cba095a076fcb9c1ef2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b801f0b4a822dce0c08d9b3515f2d3c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#a2b801f0b4a822dce0c08d9b3515f2d3c">potion_vm_proto</a> (<a class="el" href="../../dd/d07/potion_8h.html#a8218d006431d872b014396d48f881023">Potion</a> *P, <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> cl, <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> self,...)</td></tr>
<tr class="memdesc:a2b801f0b4a822dce0c08d9b3515f2d3c"><td class="mdescLeft">&#160;</td><td class="mdescRight">entrypoint for all bytecode methods from the C api.  <a href="#a2b801f0b4a822dce0c08d9b3515f2d3c">More...</a><br /></td></tr>
<tr class="separator:a2b801f0b4a822dce0c08d9b3515f2d3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab63c36540b79de6bd0edad736f30604c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#ab63c36540b79de6bd0edad736f30604c">potion_vm_class</a> (<a class="el" href="../../dd/d07/potion_8h.html#a8218d006431d872b014396d48f881023">Potion</a> *P, <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> cl, <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> self)</td></tr>
<tr class="memdesc:ab63c36540b79de6bd0edad736f30604c"><td class="mdescLeft">&#160;</td><td class="mdescRight">implements the class op creates a class (or type) from a closure and parent class with obj ivars  <a href="#ab63c36540b79de6bd0edad736f30604c">More...</a><br /></td></tr>
<tr class="separator:ab63c36540b79de6bd0edad736f30604c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af96fe06b2417036ef7db5eb6e6280da7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/d07/potion_8h.html#add34f8ce4d2a3a057fbef31b03608f87">PN_F</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#af96fe06b2417036ef7db5eb6e6280da7">potion_jit_proto</a> (<a class="el" href="../../dd/d07/potion_8h.html#a8218d006431d872b014396d48f881023">Potion</a> *P, <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> proto)</td></tr>
<tr class="separator:af96fe06b2417036ef7db5eb6e6280da7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a239bc735b262ef2b9ebf6628a94dd64e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#a239bc735b262ef2b9ebf6628a94dd64e">potion_vm_eq</a> (<a class="el" href="../../dd/d07/potion_8h.html#a8218d006431d872b014396d48f881023">Potion</a> *P, <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> a, <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> b)</td></tr>
<tr class="separator:a239bc735b262ef2b9ebf6628a94dd64e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8daa94cc6406d5e11a1eab745a5639b4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#a8daa94cc6406d5e11a1eab745a5639b4">potion_vm_neq</a> (<a class="el" href="../../dd/d07/potion_8h.html#a8218d006431d872b014396d48f881023">Potion</a> *P, <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> a, <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> b)</td></tr>
<tr class="separator:a8daa94cc6406d5e11a1eab745a5639b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb327124a1a180567093be856495b6a9"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#afb327124a1a180567093be856495b6a9">potion_sig_check</a> (<a class="el" href="../../dd/d07/potion_8h.html#a8218d006431d872b014396d48f881023">Potion</a> *P, struct <a class="el" href="../../d3/de9/struct_p_n_closure.html">PNClosure</a> *cl, int arity, int numargs)</td></tr>
<tr class="separator:afb327124a1a180567093be856495b6a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabf518e90a2085fb5cb0ab6d9aa4da61"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#aabf518e90a2085fb5cb0ab6d9aa4da61">potion_debug</a> (<a class="el" href="../../dd/d07/potion_8h.html#a8218d006431d872b014396d48f881023">Potion</a> *P, struct <a class="el" href="../../d6/d4e/struct_p_n_proto.html">PNProto</a> *f, <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> self, <a class="el" href="../../d6/d0b/struct_p_n___o_p.html">PN_OP</a> op, <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> *reg, <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> *stack)</td></tr>
<tr class="separator:aabf518e90a2085fb5cb0ab6d9aa4da61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af23b54160a0fc75ea32fe1a9b479bbea"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#af23b54160a0fc75ea32fe1a9b479bbea">potion_vm</a> (<a class="el" href="../../dd/d07/potion_8h.html#a8218d006431d872b014396d48f881023">Potion</a> *P, <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> proto, <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> self, <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> vargs, <a class="el" href="../../dd/d07/potion_8h.html#a1dbfbf639d88c38c8fcaedb9b3ba330c">PN_SIZE</a> upc, <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> *upargs)</td></tr>
<tr class="memdesc:af23b54160a0fc75ea32fe1a9b479bbea"><td class="mdescLeft">&#160;</td><td class="mdescRight">the bytecode run-loop  <a href="#af23b54160a0fc75ea32fe1a9b479bbea">More...</a><br /></td></tr>
<tr class="separator:af23b54160a0fc75ea32fe1a9b479bbea"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a3d66fb6b42284c8f482021a42fb53cb3"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#a3d66fb6b42284c8f482021a42fb53cb3">pn_readline</a> )(<a class="el" href="../../dd/d07/potion_8h.html#a8218d006431d872b014396d48f881023">Potion</a> *, <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>, <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>, <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>)</td></tr>
<tr class="separator:a3d66fb6b42284c8f482021a42fb53cb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab751dce2161ff80fe673b22eb7ea2c2f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d6/d06/struct_p_n_target.html">PNTarget</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de9/vm_8c.html#ab751dce2161ff80fe673b22eb7ea2c2f">potion_target_x86</a></td></tr>
<tr class="separator:ab751dce2161ff80fe673b22eb7ea2c2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>the vm execution loop, the "bytecode interpreter". </p>
<p>correct but slower than the jit.</p>
<p>usage: -B, -Dt or automatically when no jit is available for your architecture.</p>
<p>Potion uses a two-address register-based bytecode VM that is nearly a word-for-word copy of Lua's. The code is all different, but the bytecode is nearly identical. See <a href="http://luaforge.net/docman/83/98/ANoFrillsIntroToLua51VMInstructions.pdf">http://luaforge.net/docman/83/98/ANoFrillsIntroToLua51VMInstructions.pdf</a> or <a href="http://www.lua.org/doc/jucs05.pdf">http://www.lua.org/doc/jucs05.pdf</a></p>
<p>It is even more space-efficient than a simple stack-based VM, and of course faster. Each 32-bit op word contains the op and its two arguments. I.e. the first address R(A) is always modified, as in a stack vm. A full non-destructive three-address scheme R(D) = OP R(A), R(B) is not needed.</p>
<ul>
<li>MOVE (pos) copy value between registers R(A)=R(B)</li>
<li>LOADK (pos, need) load a constant into a register R(A)=value[B]</li>
<li>LOADPN (pos) load a PN value into a register R(A)=B</li>
<li>SELF (pos, need) prepare an object method for calling R(A+1) := R(B); R(A) := R(B)[RK(C)]</li>
<li>GETLOCAL (pos, regs) read a local into a register R(A)=local[B])</li>
<li>SETLOCAL (pos, regs) write a register value into a local local[A]=R(B)</li>
<li>GETUPVAL (pos, lregs) read an upvalue (upper scope) R(A)=upval[B]</li>
<li>SETUPVAL (pos, lregs) write to an upvalue upval[A]=R(B)</li>
<li>GLOBAL (pos, need) returns a global (for get or set) name R(A)= value R(B)</li>
<li>NEWTUPLE (pos, need) create tuple R(A)=()</li>
<li>GETTUPLE (pos, need) get tuple key R(A)=R(A)(B&amp;1024?R(B):B)</li>
<li>SETTUPLE (pos, need) write register into tuple key R(A)=push(R(A), R(B)</li>
<li>GETTABLE (pos, need) get table entry R(A)=R(A){B}</li>
<li>SETTABLE (pos, need) write register into a table entry R(A) = R(A){R(A+1)} = R(B)</li>
<li>NEWLICK (pos, need) create lick. R(A) := {} (size = B,C)</li>
<li>GETPATH (pos, need) read obj field obj_get(R(A), R(B))</li>
<li>SETPATH (pos, need) write into obj field obj_set(R(A), R(A+1), R(B))</li>
<li>ADD (pos, need) R(A) = R(A) + R(B)</li>
<li>SUB (pos, need) R(A) = R(A) - R(B)</li>
<li>MULT (pos, need) -"-</li>
<li>DIV (pos, need)</li>
<li>REM (pos, need)</li>
<li>POW (pos, need)</li>
<li>NOT (pos) R(A) = !R(A)</li>
<li>CMP (pos) R(A) = int( R(B) - R(A) )</li>
<li>NEQ (pos) R(A) = R(A) != R(B)</li>
<li>EQ (pos) R(A) = R(A) == R(B)</li>
<li>LT (pos) R(A) = R(A) &lt; R(B)</li>
<li>LTE (pos) R(A) = R(A) &lt;= R(B)</li>
<li>GT (pos) R(A) = R(A) &gt; R(B)</li>
<li>GTE (pos) R(A) = R(A) &gt;= R(B)</li>
<li>BITN (pos, need) R(A) = ~R(B)</li>
<li>BITL (pos, need) R(A) = R(A) &lt;&lt; R(B)</li>
<li>BITR (pos, need) R(A) = R(A) &gt;&gt; R(B)</li>
<li>DEF (pos, need) def_method(R(A), R(A+1), R(B)) define a method for an object</li>
<li>BIND (pos, need) bind(R(A), R(B)) method lookup for receiver A and message B <a href="http://piumarta.com/software/cola/colas-whitepaper.pdf">http://piumarta.com/software/cola/colas-whitepaper.pdf</a></li>
<li>MSG (pos, need) message(R(A), R(B)) call a method of an object</li>
<li>JMP (pos, jmps, offs, &amp;jmpc) pos += R(A)</li>
<li>TEST (pos) R(A) = bool R(A)</li>
<li>TESTJMP (pos, jmps, offs, &amp;jmpc) if R(A) pos += R(B)</li>
<li>NOTJMP (pos, jmps, offs, &amp;jmpc) if !R(A) pos += R(B)</li>
<li>NAMED (pos, need) assign named args before a CALL</li>
<li>CALL (pos, need) call a function. R(A),...:= R(A)(R(A+1),...,R(A+B-1)</li>
<li>CALLSET (pos, need) get default writer for R(B) R(A)=get_callset(R(B))</li>
<li>TAILCALL(pos, need) ? jumps back to the function entry (TODO)</li>
<li>RETURN (pos) return R(A), ... ,R(A+B-2)</li>
<li>PROTO (&amp;pos, lregs, need, regs) define a method prototype</li>
<li>CLASS (pos, need) R(A) = vm_class(R(B), R(A)) creates class from closure B and parent A</li>
<li>DEBUG (pos) set ast to lineno</li>
</ul>
<p>(c) 2008 why the lucky stiff, the freelance professor (c) 2013-2015 by perl11 org </p>

<p class="definition">Definition in file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a1190440d6cfda0c07c3aceed5c69cdfa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1190440d6cfda0c07c3aceed5c69cdfa">&#9670;&nbsp;</a></span>DEBUG_IN_C</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_IN_C</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l00095">95</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

</div>
</div>
<a id="a27b296fccb4da1e9cfcf1f9c810e619e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a27b296fccb4da1e9cfcf1f9c810e619e">&#9670;&nbsp;</a></span>STACK_MAX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STACK_MAX&#160;&#160;&#160;4096</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l00216">216</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

</div>
</div>
<a id="ac0d60f35e73dff59f1522b9403410b41"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0d60f35e73dff59f1522b9403410b41">&#9670;&nbsp;</a></span>JUMPS_MAX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define JUMPS_MAX&#160;&#160;&#160;1024</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l00217">217</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

</div>
</div>
<a id="a65a37a7116a55e32f389eb26a744d647"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a65a37a7116a55e32f389eb26a744d647">&#9670;&nbsp;</a></span>CASE_OP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CASE_OP</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="../../d2/d47/compile_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="../../d2/d47/compile_8c.html#a696b922b70259bfcac0d3acf49cdf178">args</a>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;case OP_##name: target-&gt;op[OP_##<a class="el" href="../../d2/d47/compile_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>]<a class="el" href="../../d2/d47/compile_8c.html#a696b922b70259bfcac0d3acf49cdf178">args</a>; break;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l00219">219</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

</div>
</div>
<a id="a52b5b4d420539ca92456c045c481368b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a52b5b4d420539ca92456c045c481368b">&#9670;&nbsp;</a></span>PN_VM_MATH2</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PN_VM_MATH2</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="../../d2/d47/compile_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">oper&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">if</span> (<a class="code" href="../../dd/d07/potion_8h.html#a072288a6706ad838d483090957a36979">PN_IS_INT</a>(reg[op.a]) &amp;&amp; <a class="code" href="../../dd/d07/potion_8h.html#a072288a6706ad838d483090957a36979">PN_IS_INT</a>(reg[op.b]))         \</div><div class="line">    reg[op.a] = <a class="code" href="../../dd/d07/potion_8h.html#a6e594ae2504f34b066105706a4573527">PN_NUM</a>(<a class="code" href="../../dd/d07/potion_8h.html#a2aef8d61c0327ccc388c4c5a2d388108">PN_INT</a>(reg[op.a]) oper <a class="code" href="../../dd/d07/potion_8h.html#a2aef8d61c0327ccc388c4c5a2d388108">PN_INT</a>(reg[op.b])); \</div><div class="line">  else {                                                          \</div><div class="line">    PN_CHECK_NUM(reg[op.a]);                                      \</div><div class="line">    PN_CHECK_NUM(reg[op.b]);                                      \</div><div class="line">    reg[op.a] = potion_obj_##<a class="code" href="../../d2/d47/compile_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>(P, reg[op.a], reg[op.b]);       \</div><div class="line">  }</div><div class="ttc" id="potion_8h_html_a2aef8d61c0327ccc388c4c5a2d388108"><div class="ttname"><a href="../../dd/d07/potion_8h.html#a2aef8d61c0327ccc388c4c5a2d388108">PN_INT</a></div><div class="ttdeci">#define PN_INT(x)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d07/potion_8h_source.html#l00205">potion.h:205</a></div></div>
<div class="ttc" id="potion_8h_html_a6e594ae2504f34b066105706a4573527"><div class="ttname"><a href="../../dd/d07/potion_8h.html#a6e594ae2504f34b066105706a4573527">PN_NUM</a></div><div class="ttdeci">#define PN_NUM(i)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d07/potion_8h_source.html#l00204">potion.h:204</a></div></div>
<div class="ttc" id="potion_8h_html_a072288a6706ad838d483090957a36979"><div class="ttname"><a href="../../dd/d07/potion_8h.html#a072288a6706ad838d483090957a36979">PN_IS_INT</a></div><div class="ttdeci">#define PN_IS_INT(v)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d07/potion_8h_source.html#l00162">potion.h:162</a></div></div>
<div class="ttc" id="compile_8c_html_a8f8f80d37794cde9472343e4487ba3eb"><div class="ttname"><a href="../../d2/d47/compile_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d47/compile_8c_source.html#l00030">compile.c:30</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l00369">369</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

</div>
</div>
<a id="a23768bb10de9c4d20cb1b74b8a951a3e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23768bb10de9c4d20cb1b74b8a951a3e">&#9670;&nbsp;</a></span>PN_VM_MATH3</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PN_VM_MATH3</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="../../d2/d47/compile_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">oper, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">ov&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;<a class="el" href="../../de/de9/vm_8c.html#a52b5b4d420539ca92456c045c481368b">PN_VM_MATH2</a>(<a class="el" href="../../d2/d47/compile_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, oper)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l00401">401</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

</div>
</div>
<a id="ab6272743ca8f74f9bf773bc00a29b6d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab6272743ca8f74f9bf773bc00a29b6d6">&#9670;&nbsp;</a></span>PN_VM_NUMCMP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PN_VM_NUMCMP</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">cmp</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">if</span> (<a class="code" href="../../dd/d07/potion_8h.html#a072288a6706ad838d483090957a36979">PN_IS_INT</a>(reg[op.a]) &amp;&amp; <a class="code" href="../../dd/d07/potion_8h.html#a072288a6706ad838d483090957a36979">PN_IS_INT</a>(reg[op.b]))         \</div><div class="line">    reg[op.a] = <a class="code" href="../../dd/d07/potion_8h.html#a96d4472473cb580c2c892e666e7e70ae">PN_BOOL</a>(reg[op.a] cmp reg[op.b]);         \</div><div class="line">  else {                                                          \</div><div class="line">    PN_CHECK_NUM(reg[op.a]);                                      \</div><div class="line">    PN_CHECK_NUM(reg[op.b]);                                      \</div><div class="line">    reg[op.a] = <a class="code" href="../../dd/d07/potion_8h.html#a96d4472473cb580c2c892e666e7e70ae">PN_BOOL</a>(<a class="code" href="../../dd/d07/potion_8h.html#adbcf213b08abbbed2b73d3c6d021caaa">PN_DBL</a>(reg[op.a]) cmp <a class="code" href="../../dd/d07/potion_8h.html#adbcf213b08abbbed2b73d3c6d021caaa">PN_DBL</a>(reg[op.b])); \</div><div class="line">  }</div><div class="ttc" id="potion_8h_html_a96d4472473cb580c2c892e666e7e70ae"><div class="ttname"><a href="../../dd/d07/potion_8h.html#a96d4472473cb580c2c892e666e7e70ae">PN_BOOL</a></div><div class="ttdeci">#define PN_BOOL(v)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d07/potion_8h_source.html#l00158">potion.h:158</a></div></div>
<div class="ttc" id="potion_8h_html_adbcf213b08abbbed2b73d3c6d021caaa"><div class="ttname"><a href="../../dd/d07/potion_8h.html#adbcf213b08abbbed2b73d3c6d021caaa">PN_DBL</a></div><div class="ttdeci">#define PN_DBL(num)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d07/potion_8h_source.html#l00206">potion.h:206</a></div></div>
<div class="ttc" id="potion_8h_html_a072288a6706ad838d483090957a36979"><div class="ttname"><a href="../../dd/d07/potion_8h.html#a072288a6706ad838d483090957a36979">PN_IS_INT</a></div><div class="ttdeci">#define PN_IS_INT(v)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d07/potion_8h_source.html#l00162">potion.h:162</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l00405">405</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

</div>
</div>
<a id="a1475d3cd0164f9acb0f3755c4295befa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1475d3cd0164f9acb0f3755c4295befa">&#9670;&nbsp;</a></span>PN_VM_CMP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PN_VM_CMP</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">cmp</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">reg[op.a] = cmp ? <a class="code" href="../../de/de9/vm_8c.html#a239bc735b262ef2b9ebf6628a94dd64e">potion_vm_eq</a>(P,  reg[op.a], reg[op.b]) \</div><div class="line">                                       : <a class="code" href="../../de/de9/vm_8c.html#a8daa94cc6406d5e11a1eab745a5639b4">potion_vm_neq</a>(P, reg[op.a], reg[op.b]);</div><div class="ttc" id="vm_8c_html_a8daa94cc6406d5e11a1eab745a5639b4"><div class="ttname"><a href="../../de/de9/vm_8c.html#a8daa94cc6406d5e11a1eab745a5639b4">potion_vm_neq</a></div><div class="ttdeci">PN potion_vm_neq(Potion *P, PN a, PN b)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/de9/vm_8c_source.html#l00429">vm.c:429</a></div></div>
<div class="ttc" id="vm_8c_html_a239bc735b262ef2b9ebf6628a94dd64e"><div class="ttname"><a href="../../de/de9/vm_8c.html#a239bc735b262ef2b9ebf6628a94dd64e">potion_vm_eq</a></div><div class="ttdeci">PN potion_vm_eq(Potion *P, PN a, PN b)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/de9/vm_8c_source.html#l00418">vm.c:418</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l00414">414</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

</div>
</div>
<a id="a6343b48e6930795fb31fac1833c7749a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6343b48e6930795fb31fac1833c7749a">&#9670;&nbsp;</a></span>L</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define L</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">op</td><td>)</td>
          <td>&#160;&#160;&#160;L_##op</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="afcab46b56d9082d983c0b03989e590ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afcab46b56d9082d983c0b03989e590ee">&#9670;&nbsp;</a></span>SWITCH_START</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SWITCH_START</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">op</td><td>)</td>
          <td>&#160;&#160;&#160;goto *jmptbl[op.code];</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a153f27ef7492a37273c263427099ceb6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a153f27ef7492a37273c263427099ceb6">&#9670;&nbsp;</a></span>CASE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CASE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">op, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">block&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;<a class="el" href="../../de/de9/vm_8c.html#a6343b48e6930795fb31fac1833c7749a">L</a>(op): { block; } goto L_end;</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a886e28203c262455d99122704a9f0be9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a886e28203c262455d99122704a9f0be9">&#9670;&nbsp;</a></span>SWITCH_END</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SWITCH_END&#160;&#160;&#160;L_end: ;</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="a99fb83031ce9923c84392b4e92f956b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99fb83031ce9923c84392b4e92f956b5">&#9670;&nbsp;</a></span>anonymous enum</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a99fb83031ce9923c84392b4e92f956b5a976f4de2b5b0dcf52111e7518a3b253d"></a>DBG_STEP&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a99fb83031ce9923c84392b4e92f956b5a269f85d8d6e1c649eaec51db48af8722"></a>DBG_NEXT&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a99fb83031ce9923c84392b4e92f956b5aaf2b97d2e3071fa366bed80b171098fe"></a>DBG_RUN&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a99fb83031ce9923c84392b4e92f956b5a75cf8929d9fa302de05912ff7e3a8877"></a>DBG_QUIT&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a99fb83031ce9923c84392b4e92f956b5a6aed3f78de1f8030bc5fd5281384057a"></a>DBG_EXIT&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l00098">98</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a43f53d1bb0ff2cba095a076fcb9c1ef2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43f53d1bb0ff2cba095a076fcb9c1ef2">&#9670;&nbsp;</a></span>potion_vm_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void potion_vm_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a8218d006431d872b014396d48f881023">Potion</a> *&#160;</td>
          <td class="paramname"><em>P</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l00129">129</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

</div>
</div>
<a id="a2b801f0b4a822dce0c08d9b3515f2d3c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b801f0b4a822dce0c08d9b3515f2d3c">&#9670;&nbsp;</a></span>potion_vm_proto()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> potion_vm_proto </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a8218d006431d872b014396d48f881023">Potion</a> *&#160;</td>
          <td class="paramname"><em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>&#160;</td>
          <td class="paramname"><em>cl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>entrypoint for all bytecode methods from the C api. </p>
<dl class="section see"><dt>See also</dt><dd>potion_test_eval() </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cl</td><td><a class="el" href="../../d3/de9/struct_p_n_closure.html" title="a closure is an anonymous function, without closed values, ">PNClosure</a> to be called </td></tr>
    <tr><td class="paramname">self</td><td>PN - sets self (ignored for most user defined functions). if self is a int &lt; 10 it defines the number of args provided </td></tr>
    <tr><td class="paramname">...</td><td>- arguments to the cl</td></tr>
  </table>
  </dd>
</dl>
<pre class="fragment">  add = potion_eval(P, potion_str(P, "(x=N|y=N): x + y."));
  addfn = PN_CLOSURE_F(add); // i.e. potion_vm_proto
  num = addfn(P, add, 2, PN_NUM(3), PN_NUM(5));
  num = addfn(P, add, 1, PN_NUM(3)); // 1 arg provided, 2nd arg=0
</pre><p>Note that methods with optional arguments ... are not very safe to call. <a class="el" href="../../de/de9/vm_8c.html#a2b801f0b4a822dce0c08d9b3515f2d3c" title="entrypoint for all bytecode methods from the C api. ">potion_vm_proto()</a> does not know the number of arguments on the stack. So it checks for all optional args the matching type. You can help by providing numargs as self argument if numargs &lt; 10. </p>

<p class="definition">Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l00159">159</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

</div>
</div>
<a id="ab63c36540b79de6bd0edad736f30604c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab63c36540b79de6bd0edad736f30604c">&#9670;&nbsp;</a></span>potion_vm_class()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> potion_vm_class </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a8218d006431d872b014396d48f881023">Potion</a> *&#160;</td>
          <td class="paramname"><em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>&#160;</td>
          <td class="paramname"><em>cl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>&#160;</td>
          <td class="paramname"><em>self</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>implements the class op creates a class (or type) from a closure and parent class with obj ivars </p>

<p class="definition">Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l00203">203</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

</div>
</div>
<a id="af96fe06b2417036ef7db5eb6e6280da7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af96fe06b2417036ef7db5eb6e6280da7">&#9670;&nbsp;</a></span>potion_jit_proto()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d07/potion_8h.html#add34f8ce4d2a3a057fbef31b03608f87">PN_F</a> potion_jit_proto </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a8218d006431d872b014396d48f881023">Potion</a> *&#160;</td>
          <td class="paramname"><em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>&#160;</td>
          <td class="paramname"><em>proto</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l00221">221</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

</div>
</div>
<a id="a239bc735b262ef2b9ebf6628a94dd64e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a239bc735b262ef2b9ebf6628a94dd64e">&#9670;&nbsp;</a></span>potion_vm_eq()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> potion_vm_eq </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a8218d006431d872b014396d48f881023">Potion</a> *&#160;</td>
          <td class="paramname"><em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l00418">418</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

</div>
</div>
<a id="a8daa94cc6406d5e11a1eab745a5639b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8daa94cc6406d5e11a1eab745a5639b4">&#9670;&nbsp;</a></span>potion_vm_neq()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> potion_vm_neq </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a8218d006431d872b014396d48f881023">Potion</a> *&#160;</td>
          <td class="paramname"><em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l00429">429</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

</div>
</div>
<a id="afb327124a1a180567093be856495b6a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb327124a1a180567093be856495b6a9">&#9670;&nbsp;</a></span>potion_sig_check()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> potion_sig_check </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a8218d006431d872b014396d48f881023">Potion</a> *&#160;</td>
          <td class="paramname"><em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d3/de9/struct_p_n_closure.html">PNClosure</a> *&#160;</td>
          <td class="paramname"><em>cl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>arity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>numargs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l00440">440</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

</div>
</div>
<a id="aabf518e90a2085fb5cb0ab6d9aa4da61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aabf518e90a2085fb5cb0ab6d9aa4da61">&#9670;&nbsp;</a></span>potion_debug()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> potion_debug </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a8218d006431d872b014396d48f881023">Potion</a> *&#160;</td>
          <td class="paramname"><em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d6/d4e/struct_p_n_proto.html">PNProto</a> *&#160;</td>
          <td class="paramname"><em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d0b/struct_p_n___o_p.html">PN_OP</a>&#160;</td>
          <td class="paramname"><em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> *&#160;</td>
          <td class="paramname"><em>reg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> *&#160;</td>
          <td class="paramname"><em>stack</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l00458">458</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

</div>
</div>
<a id="af23b54160a0fc75ea32fe1a9b479bbea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af23b54160a0fc75ea32fe1a9b479bbea">&#9670;&nbsp;</a></span>potion_vm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> potion_vm </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a8218d006431d872b014396d48f881023">Potion</a> *&#160;</td>
          <td class="paramname"><em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>&#160;</td>
          <td class="paramname"><em>proto</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>&#160;</td>
          <td class="paramname"><em>vargs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a1dbfbf639d88c38c8fcaedb9b3ba330c">PN_SIZE</a>&#160;</td>
          <td class="paramname"><em>upc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a> *&#160;</td>
          <td class="paramname"><em>upargs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>the bytecode run-loop </p>

<p class="definition">Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l00596">596</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a3d66fb6b42284c8f482021a42fb53cb3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d66fb6b42284c8f482021a42fb53cb3">&#9670;&nbsp;</a></span>pn_readline</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>(* pn_readline) (<a class="el" href="../../dd/d07/potion_8h.html#a8218d006431d872b014396d48f881023">Potion</a> *, <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>, <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>, <a class="el" href="../../dd/d07/potion_8h.html#a602546b9119b5381d9fcd29d457bd8d2">PN</a>)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l00105">105</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

</div>
</div>
<a id="ab751dce2161ff80fe673b22eb7ea2c2f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab751dce2161ff80fe673b22eb7ea2c2f">&#9670;&nbsp;</a></span>potion_target_x86</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d6/d06/struct_p_n_target.html">PNTarget</a> potion_target_x86</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Feb 02 2018 for potion ."1289" (date="2015-11-08")
) by <a href="http://www.doxygen.org/index.html">doxygen</a>  1.8.13
</small></address></body></html>
